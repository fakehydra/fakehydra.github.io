<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <meta name="description" content="淡望余生，漫漫回忆如你" />
  

  
  
  
  
  
  
  <title>Linux运维学习-第二十天 | 瑾川</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="True love is like ghosts ,which everybody talks about and few have seen.真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。">
<meta name="keywords" content="学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux运维学习-第二十天">
<meta property="og:url" content="http://yoursite.com/2018/07/30/Linux运维学习-第二十天/index.html">
<meta property="og:site_name" content="瑾川">
<meta property="og:description" content="True love is like ghosts ,which everybody talks about and few have seen.真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-07-30T13:10:26.085Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux运维学习-第二十天">
<meta name="twitter:description" content="True love is like ghosts ,which everybody talks about and few have seen.真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="瑾川" rel="home">瑾川</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">心有爱鬼，血祭蔷薇</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://blog.csdn.net/fake_hydra">fakehydra</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://www.cnblogs.com/kingle-study">kingle</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://lemonsu9.github.io/">xmy</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main"><article id="post-Linux运维学习-第二十天" class="post-Linux运维学习-第二十天 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title article-title">
      Linux运维学习-第二十天
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://yoursite.com/2018/07/30/Linux运维学习-第二十天/" data-id="cjvymm6ta00192kg166h1ry07" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h3 id="True-love-is-like-ghosts-which-everybody-talks-about-and-few-have-seen"><a href="#True-love-is-like-ghosts-which-everybody-talks-about-and-few-have-seen" class="headerlink" title="True love is like ghosts ,which everybody talks about and few have seen."></a>True love is like ghosts ,which everybody talks about and few have seen.</h3><h3 id="真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。"><a href="#真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。" class="headerlink" title="真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。"></a>真正的爱情犹如幽灵，人人都说过，但几乎没谁见过。</h3><a id="more"></a>
<h4 id="测验练习一：每分钟将自己的名字追加到-oldboy-oldboy-txt中"><a href="#测验练习一：每分钟将自己的名字追加到-oldboy-oldboy-txt中" class="headerlink" title="测验练习一：每分钟将自己的名字追加到/oldboy/oldboy.txt中"></a>测验练习一：每分钟将自己的名字追加到/oldboy/oldboy.txt中</h4><pre><code>第一个里程：在命令行测试定时任务命令
mkdir -p /oldboy/
echo &apos;oldboy&apos; &gt;&gt;/oldboy/oldboy.txt

第二个里程：编写定时任务
crontab -e
# editer file info
00 * * * * echo &apos;oldboy&apos; &gt;&gt;/oldboy/oldboy.txt

第三个里程：检查日志输出信息和测试定时任务效果
确认没有问题，可以最终编写定时任务时间
</code></pre><h4 id="测验练习二：每分钟显示系统时间（年-月-日-周）追加到-tmp-time-log"><a href="#测验练习二：每分钟显示系统时间（年-月-日-周）追加到-tmp-time-log" class="headerlink" title="测验练习二：每分钟显示系统时间（年-月-日_周）追加到/tmp/time.log"></a>测验练习二：每分钟显示系统时间（年-月-日_周）追加到/tmp/time.log</h4><pre><code>第一个里程：在命令行测试定时任务
date +%y-%m-%d_%w &gt;&gt;/tmp/time.log

第二个里程：编写定时任务
# time info input file
* * * * *  date +\%y-\%m-\%d_\%w &gt;&gt;/tmp/time.log
说明：定时任务中无法识别一些命令行中的特殊符号，需要进行转译识别

第三个里程：检查定时任务执行效果
</code></pre><h4 id="PS：建议由特殊符号的命令，或者需要多个命令完成一件任务的时候利用脚本编写定时任务信息"><a href="#PS：建议由特殊符号的命令，或者需要多个命令完成一件任务的时候利用脚本编写定时任务信息" class="headerlink" title="PS：建议由特殊符号的命令，或者需要多个命令完成一件任务的时候利用脚本编写定时任务信息"></a>PS：建议由特殊符号的命令，或者需要多个命令完成一件任务的时候利用脚本编写定时任务信息</h4><h4 id="异常提示信息"><a href="#异常提示信息" class="headerlink" title="异常提示信息"></a>异常提示信息</h4><pre><code>You have new mail in /var/spool/mail/root


在一个文件中输入时间信息（年-月-日），并且显示实时的负载信息uptime
所有操作命令放入脚本中，在定时任务中运行编写好的脚本
每天的7,8,10整运行脚本

2017-07-27 load average: 0.00, 0.00, 0.00

第一个里程：命令执行测试
date +%F-%w 
uptime|awk -F &quot;(s,  )&quot;  &apos;{print $2}&apos;
echo &quot;`date +%F-%w` `uptime|awk -F &quot;(s,  )&quot;  &apos;{print $2}&apos;`&quot; &gt;&gt;/tmp/oldboy.txt


第二个里程：编写脚本文件
mkdir /server/scripts -p
vim shell01.sh
echo &quot;`date +%F-%w` `uptime|awk -F &quot;(s,  )&quot;  &apos;{print $2}&apos;`&quot; &gt;&gt;/tmp/oldboy.txt

第三个里程：测试脚本
/bin/sh ./shell01.sh 
说明：尽量用绝对路径进行测试

第四个里程：编写定时任务
crontab -e 
# display upload info in /tmp/oldboy.txt
00 7,8,10 * * * sh ./shell01.sh   错误的
00 7,8,10 * * * /bin/sh /server/scripts/shell01.sh  正确效果

第五个里程：进行检查测试
查看日志
检查结果

说明：
定时任务中默认的路径为：
管理用户而言：相对/root家目录
普通用户而言：相对/home/oldboy家目录
</code></pre><h3 id="疑问：什么叫把信息追加到一个黑洞中？"><a href="#疑问：什么叫把信息追加到一个黑洞中？" class="headerlink" title="疑问：什么叫把信息追加到一个黑洞中？"></a>疑问：什么叫把信息追加到一个黑洞中？</h3><pre><code>echo 123456 &gt;oldboy.txt     正确
ech  123456 2&gt;oldboy.txt    错误

1) echo 123456 &gt;&gt;/dev/null  2&gt;&gt;/dev/null  错误和正确信息同时放入一个文件中
2）echo 123456 &gt;/dev/null  2&gt;&gt;&amp;1
3）echo 123456 &amp;&gt;/dev/null
</code></pre><h4 id="如何实现把命令输出的信息放入到一个文件中，但不占用磁盘空间–"><a href="#如何实现把命令输出的信息放入到一个文件中，但不占用磁盘空间–" class="headerlink" title="如何实现把命令输出的信息放入到一个文件中，但不占用磁盘空间–"></a>如何实现把命令输出的信息放入到一个文件中，但不占用磁盘空间–</h4><pre><code>ll /dev/null 
crw-rw-rw- 1 root root 1, 3 Jul 26 08:30 /dev/null
</code></pre><h4 id="案例：编写定时任务之后，一段时间后，会出现磁盘不能创建文件的情况？"><a href="#案例：编写定时任务之后，一段时间后，会出现磁盘不能创建文件的情况？" class="headerlink" title="案例：编写定时任务之后，一段时间后，会出现磁盘不能创建文件的情况？"></a>案例：编写定时任务之后，一段时间后，会出现磁盘不能创建文件的情况？</h4><pre><code>为什么要把输出的信息放入到黑洞中？inode（大量小文件）
异常提示信息
You have new mail in /var/spool/mail/root
1）为什么会有这么一个邮件
定时任务中，将命令执行输出的结果以邮件方式告知
因为开启了邮件服务
如果关闭了，/var/spool/mail/root就不会产生邮件信息
会生成一些没有发出的邮件，会堆积在一个目录中
/var/spool/postfix/maildrop/

如何删除大量小文件：
rm -f ./*.txt

find ./ -type f -name &quot;*.txt&quot;|xargs rm
-bash: /bin/touch: Argument list too long
解决：分批删除
ls ./{1..45000}.txt|xargs rm
</code></pre><h4 id="如何避免出现问题："><a href="#如何避免出现问题：" class="headerlink" title="如何避免出现问题："></a>如何避免出现问题：</h4><pre><code>在编写定时任务是，将命令或脚本输出的结果放入到黑洞中
[root@oldgirl oldboy]# vim /var/spool/cron/root 
# info
* * * * * /usr/sbin/ntpdate ntp1.aliyun.com &gt;/dev/null 2&gt;&amp;1
</code></pre><h4 id="测验练习：每天01-00，进行打包备份数据（-etc-hosts-etc-selinux）"><a href="#测验练习：每天01-00，进行打包备份数据（-etc-hosts-etc-selinux）" class="headerlink" title="测验练习：每天01:00，进行打包备份数据（/etc/hosts /etc/selinux）"></a>测验练习：每天01:00，进行打包备份数据（/etc/hosts /etc/selinux）</h4><pre><code>          将生成压缩包保存到/tmp目录下，并且打包数据名称不能重复（按照时间打包）
1）编写脚本实现
2）定时任务编写信息
3）定时执行日志信息
4）定时任务执行结果信息    

第一里程：命令行测试执行命令
cd / &amp;&amp; tar zcf /tmp/oldboy_$(date +%F-%H:%M).tar.gz ./etc/hosts ./etc/selinux/

第二里程：编写测试脚本
vim /server/scripts/shell02.sh
cd / &amp;&amp; tar zcf /tmp/oldboy_$(date +%F-%H:%M).tar.gz ./etc/hosts ./etc/selinux/
/bin/sh /server/scripts/shell02.sh

第三里程：编写定时任务
# backup data
* * * * * /bin/sh /server/scripts/shell02.sh &gt;/dev/null 2&gt;&amp;1

第四里程：测试定时任务
检查日志信息，查看定时任务执行效果
</code></pre><h4 id="测验练习：将主机的IP地址（ifconfig）信息追加到-tmp-oldboy-txt文件中"><a href="#测验练习：将主机的IP地址（ifconfig）信息追加到-tmp-oldboy-txt文件中" class="headerlink" title="测验练习：将主机的IP地址（ifconfig）信息追加到/tmp/oldboy.txt文件中"></a>测验练习：将主机的IP地址（ifconfig）信息追加到/tmp/oldboy.txt文件中</h4><pre><code>           按照每隔5五分钟追加一次（不要用脚本实现）
1）定时任务编写信息
ifconfig &gt;/tmp/oldboy.txt
2）定时执行日志信息
3）定时任务执行结果信息    
考点说明：对应定时服务，执行定时任务中的命令，是无法识别系统中PATH环境变量信息
定时任务中执行命令（ifconfig），会到什么位置找这个命令文件？
/bin /usr/bin

自动化编写定时任务脚本


1.9.4 linux定时任务生产java服务无法执行问题群友案例
 1.9.4.1    原来问题：
 来自网友兄弟 北京@Grady的总结。
 1）我写了一个重启resin(java)的脚本，由于业务原因，需要定时在某一个时间重启下resin服务器，于是就在
 crontab里配置了如下内容：
 50 17 * * 01-05 /bin/sh /usr/local/bin/resin_restart.sh &gt;/dev/null 2&gt;&amp;1#系统定时任务的配置文件
 其中，resin_restart.sh内容如下：
 #!/bin/sh
 /usr/local/bin/xxresin_stop.sh
 /usr/local/bin/xxresin_start.sh
 2）有问题的时刻到来了，服务器虽然定时起来了，但是却报了如下错误：
 Resin can&apos;t load com.sun.tools.javac.Main.  ####ifconfig command not found 
 Usually this means that the JDK tools.jar is missing from the classpath(java里面缺少PATH变量      java找不到对应的命令的位置), ###
 possibly because of using a JRE instead of the JDK.  
 You can either add tools.jar to the classpath or change the compiler to an external one with &lt;java compiler=&apos;javac&apos;     /&gt; or jikes.
 但是，明明已经在/etc/profile里配置了环境变量，为啥还找不到呢。折腾了许久没有搞定。

 4）然后我在resin重启脚本里重新定义了下环境变量，脚本如下：
 #!/bin/sh
 #下面就是环境变量定义
 export JAVA_HOME=&quot;/opt/jdk1.6.0_18&quot;
 export CLASSPATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
 export PATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:/opt/nginx-0.7.61/sbin:/opt/jdk1.6.0_18/bin:/opt/     resin-3.0.25/bin:$PATH
 export JAVA_HOME PATH USER LOGNAME MAIL HOSTNAME HISTSIZE INPUTRC CLASSPATH
 /usr/local/bin/xxresin_stop.sh
 /usr/local/bin/xxresin_start.sh
</code></pre>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2018/07/30/Linux运维学习-第二十天/">
    <time datetime="2018-07-30T11:18:56.000Z" class="entry-date">
        2018-07-30
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li></ul>

    </footer>
</article>


    
<nav class="nav-single">
    <h3 class="assistive-text">文章导航</h3>
    
        <span class="nav-previous"><a href="/2018/07/30/NFS—-脚本/" rel="prev"><span class="meta-nav">←</span> NFS—-脚本</a></span>
    
    
        <span class="nav-next"><a href="/2018/07/27/Linux运维学习-第十九天/" rel="next">Linux运维学习-第十九天 <span class="meta-nav">→</span></a></span>
    
</nav><!-- .nav-single -->







</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  <aside class="widget">
    <h3 class="widget-title">Music</h3>
    <div class="widget-content">
      <audio src="&lt;iframe frameborder=&#34;no&#34; border=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; width=330 height=86 src=&#34;//music.163.com/outchain/player?type=2&amp;id=461525011&amp;auto=1&amp;height=66&#34;&gt;&lt;/iframe&gt;" controls="controls"
             style="width:100%">
        您的浏览器不支持 audio 标签。
      </audio>
    </div>
  </aside>

  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2018/11/21/ct7部署SSRclient端实现xxxx/">ct7部署SSRclient端实现xxxx</a>
          </li>
        
          <li>
            <a href="/2018/11/06/docker笔记之部署安装/">docker笔记之部署安装</a>
          </li>
        
          <li>
            <a href="/2018/11/06/docker笔记之数据持久化/">docker笔记之数据持久化</a>
          </li>
        
          <li>
            <a href="/2018/11/06/docker笔记之初体验（容器管理）/">docker笔记之初体验（容器管理）</a>
          </li>
        
          <li>
            <a href="/2018/11/06/shell笔记之数组/">shell笔记之数组</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell二三事/">shell二三事</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小东西/">小东西</a><span class="tag-list-count">43</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小测试/">小测试</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/期中架构/">期中架构</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/每天一个Linux命令/">每天一个Linux命令</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浮生若梦/">浮生若梦</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/这里有一片文章/">这里有一片文章</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/那些年写过的shell/">那些年写过的shell</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/那些年学习的Linux命令/">那些年学习的Linux命令</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/Nginx/" style="font-size: 13.33px;">Nginx</a> <a href="/tags/docker/" style="font-size: 12.22px;">docker</a> <a href="/tags/nginx/" style="font-size: 11.11px;">nginx</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/shell二三事/" style="font-size: 15.56px;">shell二三事</a> <a href="/tags/学习笔记/" style="font-size: 18.89px;">学习笔记</a> <a href="/tags/小东西/" style="font-size: 20px;">小东西</a> <a href="/tags/小测试/" style="font-size: 11.11px;">小测试</a> <a href="/tags/期中架构/" style="font-size: 17.78px;">期中架构</a> <a href="/tags/每天一个Linux命令/" style="font-size: 16.67px;">每天一个Linux命令</a> <a href="/tags/浮生若梦/" style="font-size: 14.44px;">浮生若梦</a> <a href="/tags/这里有一片文章/" style="font-size: 10px;">这里有一片文章</a> <a href="/tags/那些年写过的shell/" style="font-size: 10px;">那些年写过的shell</a> <a href="/tags/那些年学习的Linux命令/" style="font-size: 12.22px;">那些年学习的Linux命令</a>
    </div>
  </aside>

  
    
  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2019 瑾川
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

<script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>