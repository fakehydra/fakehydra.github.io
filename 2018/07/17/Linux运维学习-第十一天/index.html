<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="瑾川"><link rel="alternative" href="/atom.xml" title="瑾川" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Linux运维学习-第十一天 - 瑾川</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">瑾川</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-07-17T06:40:56.000Z">July 17, 2018</time><h1 class="post__title"><a href="/2018/07/17/Linux运维学习-第十一天/">Linux运维学习-第十一天</a></h1><div class="post__main echo"><h3 id="十一天"><a href="#十一天" class="headerlink" title="十一天~"></a>十一天~</h3><a id="more"></a>
<h2 id="第二关测验练习题-续"><a href="#第二关测验练习题-续" class="headerlink" title="第二关测验练习题-续"></a>第二关测验练习题-续</h2><h2 id="第四题：已知nginx服务的访问日志按天记录在服务器本地目录-app-logs下，由于磁盘空间紧张，现在要求只能保留最近7天访问日志！"><a href="#第四题：已知nginx服务的访问日志按天记录在服务器本地目录-app-logs下，由于磁盘空间紧张，现在要求只能保留最近7天访问日志！" class="headerlink" title="第四题：已知nginx服务的访问日志按天记录在服务器本地目录/app/logs下，由于磁盘空间紧张，现在要求只能保留最近7天访问日志！"></a>第四题：已知nginx服务的访问日志按天记录在服务器本地目录/app/logs下，由于磁盘空间紧张，现在要求只能保留最近7天访问日志！</h2><h3 id="环境创建"><a href="#环境创建" class="headerlink" title="环境创建"></a>环境创建</h3><pre><code>mkdir /app/logs -p
</code></pre><h4 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h4><pre><code>由于还没搭建Nginx(虽然我自己搭好了)，所以选择是创建一个环境。因为是要删除七天前的，所以我们先得把时间修改一下，然后创建相应的文件。
</code></pre><h5 id="第一里程：修改系统时间"><a href="#第一里程：修改系统时间" class="headerlink" title="第一里程：修改系统时间"></a>第一里程：修改系统时间</h5><pre><code>[root@jinc1 ~]# date -s &quot;20150105&quot;
 Mon Jan  5 00:00:00 CST 2015
 [root@jinc1 ~]# date
 Mon Jan  5 00:00:03 CST
</code></pre><h5 id="第二里程：按天创造文件"><a href="#第二里程：按天创造文件" class="headerlink" title="第二里程：按天创造文件"></a>第二里程：按天创造文件</h5><pre><code>由于我们要的是删除七天前的文件，所以我们所创建的文件至少要有八个以上，这样的话一个一个创建就太
慢了些，在这里，我们写个脚本来完成。

循环脚本：
for 循环的变量 in 范围 ；do 循环做的事 ；done

所以我们的脚本应该写成：
 for time in {01..20} ;do date -s &quot;2015-01-$time&quot;;touch /app/logs/access_log.&quot;$date&quot;;done
 环境搭建完成
</code></pre><h3 id="解题方法"><a href="#解题方法" class="headerlink" title="解题方法"></a>解题方法</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><h5 id="解题核心：找出七天前的数据，删除"><a href="#解题核心：找出七天前的数据，删除" class="headerlink" title="解题核心：找出七天前的数据，删除"></a>解题核心：找出七天前的数据，删除</h5><p>第一步：找出七天前的数据</p>
<pre><code>find /app/logs -type f -mtime +7

-time :按天找寻数据信息
01.找寻几天前的   +x
02.找寻几天后的   -x
03.找寻第几天的    x
</code></pre><p>第二步：删除找到的东西</p>
<pre><code>方法一：[root@jinc1 logs]# find /app/logs -type f -mtime +7|xargs rm  

方法二：[root@jinc1 logs]# find /app/logs -type f -mtime +7 -exec rm {} \;

方法三：[root@jinc1 logs]# find /app/logs -type f -mtime +7 -delete

方法四：[root@jinc1 logs]#\rm $(find /app/logs -type f -mtime +7)
</code></pre><h2 id="第五题：调试系统服务时，希望能实时查看系统日志-var-log-messages的更新-如何做？"><a href="#第五题：调试系统服务时，希望能实时查看系统日志-var-log-messages的更新-如何做？" class="headerlink" title="第五题：调试系统服务时，希望能实时查看系统日志/var/log/messages的更新,如何做？"></a>第五题：调试系统服务时，希望能实时查看系统日志/var/log/messages的更新,如何做？</h2><h4 id="解题方法-1"><a href="#解题方法-1" class="headerlink" title="解题方法"></a>解题方法</h4><pre><code>tail -f   
这之前讲过，就不多说。
</code></pre><h2 id="第六题：查找-oldboy下所有以log结尾的大于1M的文件复制到-tmp目录"><a href="#第六题：查找-oldboy下所有以log结尾的大于1M的文件复制到-tmp目录" class="headerlink" title="第六题：查找/oldboy下所有以log结尾的大于1M的文件复制到/tmp目录"></a>第六题：查找/oldboy下所有以log结尾的大于1M的文件复制到/tmp目录</h2><h3 id="创建模拟环境"><a href="#创建模拟环境" class="headerlink" title="创建模拟环境"></a>创建模拟环境</h3><pre><code>[root@jinc1 oldboy]# cat /etc/services /etc/services &gt;&gt;old.txt 
[root@jinc1 oldboy]# ll old.txt -h
-rw-r--r-- 1 root root 1.3M Jul 17 10:26 old.txt
说明：cat用于合并多个文件
</code></pre><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><h5 id="第一步：找出大与1M的文件"><a href="#第一步：找出大与1M的文件" class="headerlink" title="第一步：找出大与1M的文件"></a>第一步：找出大与1M的文件</h5><pre><code>命令：find /oldboy -type f -name &quot;*.txt&quot; -size +1M
[root@jinc1 oldboy]# find ./ -type f -name &quot;*.txt&quot; -size +1M
   ./old03.txt
   ./old02.txt
   ./old.txt
   ./old01.txt
</code></pre><h5 id="第二步：将找出的文件复制到-tmp目录"><a href="#第二步：将找出的文件复制到-tmp目录" class="headerlink" title="第二步：将找出的文件复制到/tmp目录"></a>第二步：将找出的文件复制到/tmp目录</h5><pre><code>方法一：[root@jinc1 oldboy]# find ./ -type f -name &quot;*.txt&quot; -size +1M|xargs cp -t /tmp
方法二：[root@jinc1 oldboy]# find ./ -type f -name &quot;*.txt&quot; -size +1M|xargs -i cp {} /tmp
方法三：[root@jinc1 oldboy]# find ./ -type f -name &quot;*.txt&quot; -size +1M|xargs -I {} cp {} /tmp
</code></pre><h2 id="第七题：打印配置文件nginx-conf内容的行号及内容，该如何做？"><a href="#第七题：打印配置文件nginx-conf内容的行号及内容，该如何做？" class="headerlink" title="第七题：打印配置文件nginx.conf内容的行号及内容，该如何做？"></a>第七题：打印配置文件nginx.conf内容的行号及内容，该如何做？</h2><h3 id="模拟环境创建"><a href="#模拟环境创建" class="headerlink" title="模拟环境创建"></a>模拟环境创建</h3><pre><code>[root@jinc1 oldboy]# echo stu{01..20} |xargs -n1 &gt; old.txt 
</code></pre><h4 id="解题方法-2"><a href="#解题方法-2" class="headerlink" title="解题方法"></a>解题方法</h4><pre><code>方法一：vim编辑。。就不多说了。。。一般人都会
方法二：利用cat命令
[root@jinc1 oldboy]# cat -n old.txt 
方法三：利用三剑客命令：
01：grep 
 [root@jinc1 oldboy]# grep -n &quot;.&quot; old.txt 
02.sed
 [root@jinc1 oldboy]# sed &apos;=&apos; old.txt |xargs -n2
03.awk
 [root@jinc1 oldboy]# awk &apos;{print NR,$1}&apos; old.txt
</code></pre><h2 id="第八题：如何查看配置系统运行级别"><a href="#第八题：如何查看配置系统运行级别" class="headerlink" title="第八题：如何查看配置系统运行级别"></a>第八题：如何查看配置系统运行级别</h2><pre><code>cat /etc/init.d  --查看
runlevel   --查看当前系统运行级别
</code></pre><h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><pre><code>永久修改：vim /etc/inittab
临时修改：init 0
</code></pre><h2 id="第九题：装完系统后，希望让网络文件共享服务NFS-iptables-，仅在3级别上开机自启动，该如何做？"><a href="#第九题：装完系统后，希望让网络文件共享服务NFS-iptables-，仅在3级别上开机自启动，该如何做？" class="headerlink" title="第九题：装完系统后，希望让网络文件共享服务NFS(iptables)，仅在3级别上开机自启动，该如何做？"></a>第九题：装完系统后，希望让网络文件共享服务NFS(iptables)，仅在3级别上开机自启动，该如何做？</h2><h3 id="所有级别实现防火墙开机启动"><a href="#所有级别实现防火墙开机启动" class="headerlink" title="所有级别实现防火墙开机启动"></a>所有级别实现防火墙开机启动</h3><h4 id="设置方法："><a href="#设置方法：" class="headerlink" title="设置方法："></a>设置方法：</h4><pre><code>[root@jinc ~]# chkconfig iptables on  --开启
[root@jinc ~]# chkconfig |grep ipt  --查看
</code></pre><h3 id="设置服务在指定级别开机自启"><a href="#设置服务在指定级别开机自启" class="headerlink" title="设置服务在指定级别开机自启"></a>设置服务在指定级别开机自启</h3><h4 id="设置方法：-1"><a href="#设置方法：-1" class="headerlink" title="设置方法："></a>设置方法：</h4><pre><code>[root@jinc ~]# chkconfig --level 3 iptables on
[root@jinc ~]# chkconfig |grep ipt
</code></pre><h2 id="第十题：如何设置中文字符信息显示"><a href="#第十题：如何设置中文字符信息显示" class="headerlink" title="第十题：如何设置中文字符信息显示"></a>第十题：如何设置中文字符信息显示</h2><h4 id="临时修改："><a href="#临时修改：" class="headerlink" title="临时修改："></a>临时修改：</h4><pre><code>export LANG=zh_CN.UTF-8
</code></pre><h4 id="永久修改"><a href="#永久修改" class="headerlink" title="永久修改"></a>永久修改</h4><pre><code>修改/etc/sysconfig/i18n 文件
LANG=en_US.UTF-8
使之生效：source /etc/sysconfig/i18n
检查：echo $LANG
</code></pre><h2 id="第十三题：如何详细查看文件行数信息"><a href="#第十三题：如何详细查看文件行数信息" class="headerlink" title="第十三题：如何详细查看文件行数信息"></a>第十三题：如何详细查看文件行数信息</h2><h4 id="第一种方法："><a href="#第一种方法：" class="headerlink" title="第一种方法："></a>第一种方法：</h4><pre><code>cat -n line.txt|tail -1|awk &apos;{print $1}&apos;
</code></pre><h4 id="第二种方法："><a href="#第二种方法：" class="headerlink" title="第二种方法："></a>第二种方法：</h4><pre><code>wc line.txt
wc -l kine.txt
</code></pre></div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/学习笔记/">学习笔记</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 瑾川</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>